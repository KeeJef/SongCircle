<html>
<!-- Load icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<input id="searchbox" type="text" placeholder="Search.." name="search">
<button id="searchsubmit" type="submit" onclick="httpGet()"><i class="fa fa-search"></i></button>
<br>
<button id="finished" class="myButton" onclick="finished()">Finished</button>

<div id='main'></div>

</html>

<script>
searchcount = 0
googke = "AIzaSyA6UQVaGsYD85f_ZWDHk78GIl4RAqUwASE" //apparently its fine to expose your JS api key
YoutubeVidChoiceArray = []
choiceiteration = 0
currentVids = []

function httpGet()
{
    searchvar = document.getElementById("searchbox").value
    theUrl = 'https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q='+ searchvar+'&key='+ googke //remove channel results? 
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
    xmlHttp.send( null );
    data = JSON.parse(xmlHttp.responseText)
    currentVids = []
    currentVids = data.items
    renderChoice(data)
}

function renderChoice(data){

    if (searchcount != 0) {
        document.querySelectorAll('.ytinfoframe').forEach(e => e.remove());

    }

for (let index = 0; index < data.items.length; index++) {

    var ytinfoframe = document.createElement("ytinfoframe")
    var videoinfo = document.createElement("videoinfo")

    thumburl = data.items[index].snippet.thumbnails.medium.url
    titlefull = data.items[index].snippet.title 
    channelTitle = data.items[index].snippet.channelTitle

    videoinfo.innerHTML = titlefull+" ----- "+channelTitle+ "<br><img src=\""+ thumburl +"\" alt=\""+channelTitle+"\">"+"<button id=" + index  + "\" class=\"myButton\" onclick=\"setchoice("+ index +")\">âœ“</button>"


    ytinfoframe.innerHTML += "<br>"

    ytinfoframe.className = "ytinfoframe"
    videoinfo.className = "videoinfo"

    ytinfoframe.appendChild(videoinfo)

    document.getElementById("main").appendChild(ytinfoframe)
}
searchcount += 1 
}

function setchoice (choice){

urlchoice = currentVids[choice].id.videoId
YoutubeVidChoiceArray.push(urlchoice)
document.querySelectorAll('.ytinfoframe').forEach(e => e.remove());

}

function finished(){
    document.querySelectorAll('.ytinfoframe').forEach(e => e.remove());
    document.getElementById("finished").remove()
    document.getElementById("searchbox").remove()
    document.getElementById("searchsubmit").remove()
    shuffleArray(YoutubeVidChoiceArray)
    renderOne()
}

function renderOne(){

if (choiceiteration == YoutubeVidChoiceArray.length) {
    var div = document.getElementById('main');
    div.innerHTML += "You're finished"+"<br><button id=\"newround\" class=\"myButton\" onclick=\"next()\">New Round</button>"

    return
}

var infopannel = document.createElement("infopannel")
var videoplayer = document.createElement("videoplayer")
var buttons = document.createElement("buttonspane")

videoplayer.innerHTML = "<iframe width=\"420\" height=\"345\" src=\"https://www.youtube.com/embed/"+ YoutubeVidChoiceArray[choiceiteration] +"\"></iframe>"
buttons.innerHTML = "<button id=\"myButton\" class=\"myButton\" onclick=\"next()\">Next</button>"
infopannel.innerHTML = "You have " + (YoutubeVidChoiceArray.length - choiceiteration ) + " Videos to go for this round"

videoplayer.id = "videoplayer"
buttons.id = "buttonspane"
infopannel.id = "infopannel"

document.getElementById("main").appendChild(infopannel)
document.getElementById("main").appendChild(videoplayer)
document.getElementById("main").appendChild(buttons)

choiceiteration += 1 

}

function next(){
    document.getElementById("videoplayer").remove()
    document.getElementById("buttonspane").remove()
    document.getElementById("infopannel").remove()

    renderOne()
}

function shuffleArray(array) {
    for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
}

</script>

<style>

.ytinfoframe{

width: 100%;
display: block;
box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important;
margin-bottom: 30px;
padding: 10px;

}

.videoinfo{
   font-size: 20px;
}

.myButton {
	background-color:#44c767;
	border-radius:17px;
	border:1px solid #18ab29;
	display:inline-block;
	cursor:pointer;
	color:#ffffff;
	font-family:Arial;
	font-size:24px;
	padding:8px 30px;
	text-decoration:none;
	text-shadow:0px 1px 0px #2f6627;
}
.myButton:hover {
	background-color:#5cbf2a;
}
.myButton:active {
	position:relative;
	top:1px;
}


</style>
